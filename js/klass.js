/*

klass version 0.96
[JavaScript class/inheritance library]
copyright 2011 Thomas Frank

This EULA grants you the following rights:

Installation and Use. You may install and use an unlimited number of copies of the SOFTWARE PRODUCT.

Reproduction and Distribution. You may reproduce and distribute an unlimited number of copies of the SOFTWARE PRODUCT either in whole or in part; each copy should include all copyright and trademark notices, and shall be accompanied by a copy of this EULA. Copies of the SOFTWARE PRODUCT may be distributed as a standalone product or included with your own product.

Commercial Use. You may sell for profit and freely distribute scripts and/or compiled scripts that were created with the SOFTWARE PRODUCT.

*/

(function(b,a){typeof require=="undefined"?(typeof dojo!="undefined"&&dojo.provide(b))&(this[b]=a()):typeof exports=="undefined"?define(b,a):exports[b]=a()})("klass",function(){var gs={publicFuncname:"_public",privateFuncname:"_private",extendsFuncname:"_extends",singletonFuncname:"_singleton",finalFuncname:"_final",abstractFuncname:"_abstract",staticFuncname:"_static",constructorFuncname:"_constructor",superFuncname:"_super",getterFuncname:"_g",getterSetterFuncname:"_gs",prototypeChain:true,chromeConsoleClassNames:true,allowAlternativeSyntax:true};var mainConstr=function(){var a,i,j,t,t2,t3,fc,f,strippedMem,funcMem,abstractMem,staticConstr,staticPart,settings,fnames,thrower,papa,func,_global=(function(){return this})(),secretKey={};var main=function(theFunc,isStaticPart){resetVariables(theFunc,isStaticPart);extend();cleanStringVersion();stripStrings();removeComments();stripInnerFuncs();removeReturns();rewriteAnonymousFuncs();altSyntaxSupport();destripInnerFuncs();handleStatic();addCallToConstructor();handleFinalMethods();handleAbstractClass();handleAbstractMethods();publishPublicMethods();neuterPrivateMembers();createSuperMethods();removeSpecialKlassMethods();destripStrings();throwErrors();finalizeConstructor();return f};var resetVariables=function(theFunc,isStaticPart){f="";func=theFunc;staticPart=isStaticPart;abstractMem={};settings={};fnames={};thrower="";staticConstr="";papa=Object};var extend=function(){t={};for(i in gs){if(i.indexOf("Funcname")<0){break}t[gs[i]]=_global[gs[i]];_global[gs[i]]=function(){};if(i.indexOf("extendsFuncname")>=0){continue}t2=getMethodsInCall(func+"",gs[i]);for(j in t2){if(!j.replace(/\s*/g,"")){continue}t[j]=_global[j];_global[j]=function(){}}}_global[gs.singletonFuncname]=function(){var a=arguments;settings.single=a.length==0||a[0]?true:false};_global[gs.extendsFuncname]=function(){a=Array.prototype.slice.call(arguments).concat(func);a.length&&(papa=a[0])};a=[func];func();for(i in t){_global[i]=t[i];try{t[i]===undefined&&(delete _global[i])}catch(e){}}for(i=0;i<a.length;i++){if(typeof a[i]=="object"){a[i]=a[i].constructor;settings.single===undefined&&(settings.single=true)}if(typeof a[i]=="function"){a[i]=a[i].__klassCleanVer__||a[i]+"";t=a[i].substring(a[i].indexOf("{")+1,a[i].lastIndexOf("}"));f+=t;i<a.length-1&&t.indexOf("/*[klass_eop]*/")<0&&(f+="\n/*[klass_eop]*/\n")}}};var cleanStringVersion=function(){fc="function(){ "+f+"}"};var stripStrings=function(){strippedMem=stringStripper.remove(f);f=strippedMem.stripped};var destripStrings=function(){f=stringStripper.restore(f,strippedMem.strMem)};var stripInnerFuncs=function(){funcMem=funcStripper.remove(f);f=funcMem.stripped};var destripInnerFuncs=function(){f=funcStripper.restore(f,funcMem.funcMem)};var removeComments=function(){f=f.split("/*[klass_eop]*/").join("-_-klassDivTemp-_-").replace(/\/\/[^\n]*\n/g,"").split(/\n/).join("Ãƒâ€šÃ‚Â´").replace(/\/\*.*?\*\//g,"").split("Ãƒâ€šÃ‚Â´").join("\n").split("-_-klassDivTemp-_-").join("/*[klass_eop]*/")};var addCallToConstructor=function(){f.match(new RegExp("function\\s{1,}"+gs.constructorFuncname))&&(f+="\n;arguments[0]!==___klassSecretKey___ &&"+gs.constructorFuncname+".apply(this,arguments);\n")};var handleFinalMethods=function(){t=getParts(f);t2=t.pop();t=t.join();t3=getMethodsInCall(t,gs.finalFuncname);fnames=getMethodsInFunc(t2);for(i in t3){if(fnames[i]){throw ((func.name?"Klass: "+func.name+"\n":"")+"You may not redefine the final method "+i+".")}}};var handleAbstractClass=function(){t2!=removeCall(t2,gs.abstractFuncname)&&(thrower="You may not instantiate an abstract class.")};var handleAbstractMethods=function(){t=getParts(f);for(i=0;i<t.length;i++){t2=getMethodsInCall(t[i],gs.abstractFuncname);t3=t[i+1]?getMethodsInFunc(t[i+1]):{};for(j in t2){abstractMem[j]=1}for(j in t3){abstractMem[j]--}}fnames=[];for(i in abstractMem){abstractMem[i]>0&&fnames.push(i)}fnames.length&&!thrower&&(thrower="You may not instantiate a class with the abstract method"+(fnames.length>2?"s ":" ")+fnames.join(", "))};var handleStatic=function(){var s=extractFunc(f,gs.staticFuncname,true,true);var mainF=gs.extendsFuncname+"(";f=s.func;s=s.extracted;for(i=0;i<s.length;i++){s[i]=new Function(s[i]);mainF+=(i>0?",":"")+"s["+i+"]"}if(!s.length){return}eval("mainF = function statica (){"+mainF+")}");staticConstr=extraConstr(mainF,true)};var publishPublicMethods=function(){t=getMethodsInCall(f,gs.publicFuncname);t2="";for(i in t){t2+=createGettersAndSetters(i)||"this."+i+" = "+i+";\n"}f=t2+f};var createGettersAndSetters=function(x){var y=x.split(".")[1];if(x.indexOf(gs.getterFuncname+".")==0){return"this."+y+" = function(){\n\treturn "+y+"\n};\n"}if(x.indexOf(gs.getterSetterFuncname+".")==0){return"this."+y+" = function(x){\n\targuments.length && ("+y+" = x);\n\treturn "+y+"\n};\n"}};var neuterPrivateMembers=function(){t=getParts(f);var t4,t5;for(i=0;i<t.length;i++){t2=getMethodsInCall(t[i],gs.privateFuncname);t3=getMethodsInCall(t[i],gs.publicFuncname);t5=[];for(j in t2){if(t3[j]){throw ((func.name?"Klass: "+func.name+"\n":"")+"You can not make the public member "+j+" private.")}if(i<t.length-1){t4=t[i];t[i]=extractFunc(t[i],j,true).func;if(t4==t[i]){t5.push(j)}}}t5.length&&(t[i]+=";\n"+t5.join(" = ")+" = undefined;\n")}f=t.join("/*[klass_eop]*/")};var createSuperMethods=function(){fnames=getMethodsInFunc(f);for(i in fnames){t2=fnames[i];while(t2>1){t="";for(j=1;j<t2;j++){t+="__super__"}f=f.replace(new RegExp("([\\n|;]\\s*function\\s*)"+i),"$1"+t+i);t2--}t2=fnames[i]-1;while(t2>0){t="";for(j=1;j<t2;j++){t+="__super__"}f=f.replace(new RegExp("([\\n|;]\\s*function\\s*"+t+i+"[^\\{]*{)"),"$1var "+gs.superFuncname+" = __super__"+t+i+";");t2--}}};var removeSpecialKlassMethods=function(){for(i in gs){i.indexOf("Funcname")>0&&i.indexOf("constructor")<0&&i.indexOf("super")<0&&i.indexOf("static")<0&&(f=removeCall(f,gs[i]))}};var throwErrors=function(){thrower&&(f='if(arguments[0] !== ___klassSecretKey___){throw (" '+(func.name?"Klass: "+func.name+"\\n":"")+thrower+'")};\n'+f)};var finalizeConstructor=function(){if(staticConstr){t=staticConstr+"";t=t.substring(t.indexOf("{")+1,t.lastIndexOf("}"));f=t+";this.__klassPublicPart__ = function "+(func.name||"")+"(){"+f+"}"}f="this.constructor = arguments.callee;\n"+f;f=main.evaler(func.name,f,secretKey);if(staticConstr){t=typeof f=="function"?new f():f;f=t.__klassPublicPart__;for(i in t){if(i!="__klassPublicPart__"){f[i]=t[i]}}}typeof papa!="function"&&(papa=papa.constructor);if(gs.prototypeChain){try{f.prototype=new papa(secretKey)}catch(e){}}f.__klassCleanVer__=fc;if(settings.single){f=new f()}};var getMethodsInFunc=function(f){var t,i,j,fnames={};t=f.match(/[\n|;]\s*function\s*\w*/g);if(!t){return fnames}for(i=0;i<t.length;i++){j=t[i].split(/function\s*/)[1];fnames[j]=fnames[j]+1||1}return fnames};var getMethodsInCall=function(f,called){var t,t2,t3,i,j,fnames={};t=(" "+f).split(new RegExp(called+"\\s*\\("));for(i=1;i<t.length;i++){t2=t[i].split(")");t3=t2[0].split(",");for(j=0;j<t3.length;j++){t3[j]=t3[j].replace(/\s/g,"");fnames[t3[j]]=fnames[t3[j]]+1||1}}return fnames};var removeCall=function(f,called){return f.replace(new RegExp(called+"\\s*\\([^\\)]*\\);*","g"),"")};var extractFunc=function(f,funcName,remove,onlyBodies){var i,j,r,nf=[],ar=[],t,t2,t3,co;r=new RegExp("[\\n|;]\\s*function\\s*"+funcName);f=f.split(r);for(i=0;i<f.length;i++){co=i?-1:0;t=f[i].split("");t2=i?("\n;function "+funcName).split(""):[];t3=[];for(j=0;j<t.length;j++){if(co==-1){t[j]=="{"&&(co=1);t2.push(t[j])}else{if(co==0){t3.push(t[j])}else{t[j]=="{"&&(co++);t[j]=="}"&&(co--);t2.push(t[j])}}}t2=t2.join("");t3=t3.join("");!remove&&nf.push(t2);nf.push(t3);t2=stringStripper.restore(t2,strippedMem.strMem);if(onlyBodies){t2=t2.substring(t2.indexOf("{")+1,t2.lastIndexOf("}"))}i&&ar.push(t2.replace(/\W*/,""))}nf=nf.join("");return{func:nf,extracted:ar}};var getParts=function(f){f=f.split("/*[klass_eop]*/");return f};var removeReturns=function(){f=f.replace(/return/g,"")};var rewriteAnonymousFuncs=function(){f=f.replace(/([\n|;]\s*)var\s*(\w*)\s*=\s*function/g,"$1function $2").replace(/([\n|;]\s*)(\w*)\s*=\s*function/g,"$1function $2")};var altSyntaxSupport=function(){if(!gs.allowAlternativeSyntax){return}var calls="",n=[gs.publicFuncname,gs.privateFuncname,gs.abstractFuncname,gs.finalFuncname],mem={},tn,k;f=f.split(/function\s*/);t3=f[0];for(i=1;i<f.length;i++){if(!f[i]){continue}t=f[i].split(/\W/);t2=f[i].substring(t[0].length);t=t.shift();tn=t;for(j=0;j<n.length;j++){tn=tn.split(n[j]).join("")}tn!=t&&(tn=tn.replace(/_/,""));for(j=0;j<n.length;j++){if(t.indexOf(n[j])>=0){mem[n[j]]=mem[n[j]]||[];mem[n[j]].push(tn)}}for(j in mem){calls+=j+" ("+mem[j].join(",")+");\n"}t3+="function "+tn+" "+t2}f=calls+t3};var changeSettings=function(x){for(i in x){gs[i]=x[i]}return gs};var funcStripper={remove:function(str){var inFunc=0,funcMem=[],co=-1,y="";var x=str.split("");for(var i=0;i<x.length;i++){inFunc=inFunc+1*(x[i]=="{")-1*(x[i]=="}");if(x[i]=="{"){co++;y+="_-_funcMem"+co+"_-_"}if(inFunc){funcMem[co]=funcMem[co]||"";funcMem[co]+=x[i]}else{y+=x[i]}}return{stripped:y,funcMem:funcMem}},restore:function(stripped,funcMem){var x=stripped,i;for(i=0;i<funcMem.length;i++){x=x.split("_-_funcMem"+i+"_-_").join(funcMem[i])}return x}};var stringStripper={remove:function(str){var inStr=false,strMem=[],ar=[],i,co=0,x;x=str.split("");for(i=0;i<x.length;i++){if(!inStr&&(x[i]=='"'||x[i]=="'")){inStr=x[i];strMem.push([inStr]);ar.push("_-_strMem"+co+"_-_");co++;continue}if(inStr&&x[i-1]!="\\"&&x[i]==inStr){strMem[strMem.length-1].push(inStr);inStr=false;continue}(inStr?strMem[strMem.length-1]:ar).push(x[i])}ar=ar.join("");for(i=0;i<strMem.length;i++){strMem[i]=strMem[i].join("")}return{stripped:ar,strMem:strMem}},restore:function(stripped,strMem){var x=stripped,i;for(i=0;i<strMem.length;i++){x=x.split("_-_strMem"+i+"_-_").join(strMem[i])}return x}};main.evaler=new Function("name","funcStr","___klassSecretKey___","eval('var f = function ' + name + '(){ ' + funcStr + '}');return f");main.settings=changeSettings;return main};var extraConstr=mainConstr();return mainConstr()});